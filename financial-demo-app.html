<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureBank - é‡‘èãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .role-badge {
            background: #3498db;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
        }
        .role-badge.admin {
            background: #e74c3c;
        }
        .role-badge.auditor {
            background: #f39c12;
        }
        .content {
            padding: 30px;
        }
        .login-form {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .balance {
            font-size: 32px;
            color: #27ae60;
            font-weight: bold;
        }
        .card-number {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            letter-spacing: 2px;
            color: #34495e;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #3c3;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            background: #f8f9fa; /* èƒŒæ™¯è‰²ã‚’è¿½åŠ  */
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #ddd; /* ãƒœãƒ¼ãƒ€ãƒ¼ã‚’è¿½åŠ  */
            background: white; /* èƒŒæ™¯è‰²ã‚’è¿½åŠ  */
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            border-radius: 5px 5px 0 0; /* ä¸Šéƒ¨ã®ã¿è§’ä¸¸ */
            color: #2c3e50; /* ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’æ˜ç¤º */
            font-weight: 500; /* ãƒ•ã‚©ãƒ³ãƒˆå¤ªã•ã‚’è¿½åŠ  */
        }
        .tab:hover {
            background: #e9ecef; /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰² */
            border-color: #adb5bd; /* ãƒ›ãƒãƒ¼æ™‚ã®ãƒœãƒ¼ãƒ€ãƒ¼è‰² */
        }
        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
            background: white; /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã¯ç™½èƒŒæ™¯ */
            border-color: #ddd; /* ãƒœãƒ¼ãƒ€ãƒ¼ã‚’è¡¨ç¤º */
            border-bottom-color: #667eea; /* ä¸‹éƒ¨ã®ã¿å¼·èª¿è‰² */
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .transaction-form {
            max-width: 500px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .logout-btn {
            background: #e74c3c;
        }
        .logout-btn:hover {
            background: #c0392b;
        }
        .amount-input {
            font-size: 18px;
            font-weight: bold;
        }
        .mfa-code {
            max-width: 200px;
            text-align: center;
            font-size: 20px;
            letter-spacing: 5px;
        }
        .session-timer {
            background: #f39c12;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        .audit-log {
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            padding: 10px;
            border-left: 3px solid #3498db;
            margin-bottom: 10px;
            background: #f8f9fa;
        }
        .log-entry.warning {
            border-left-color: #f39c12;
        }
        .log-entry.error {
            border-left-color: #e74c3c;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ¦ SecureBank</h1>
            <div class="user-info" id="userInfo" style="display: none;">
                <span class="session-timer" id="sessionTimer">ã‚»ãƒƒã‚·ãƒ§ãƒ³: 15:00</span>
                <span id="userName"></span>
                <span class="role-badge" id="roleBadge"></span>
                <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="content">
            <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
            <div id="loginScreen">
                <div class="login-form">
                    <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">ãƒ­ã‚°ã‚¤ãƒ³</h2>
                    <div id="loginError" class="error hidden"></div>
                    
                    <div class="form-group">
                        <label for="username">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
                        <input type="text" id="username" placeholder="ä¾‹: customer01">
                    </div>
                    
                    <div class="form-group">
                        <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
                    </div>
                    
                    <div class="form-group">
                        <label for="role">å½¹å‰²</label>
                        <select id="role">
                            <option value="customer">ä¸€èˆ¬é¡§å®¢</option>
                            <option value="admin">ç®¡ç†è€…</option>
                            <option value="auditor">ç›£æŸ»è€…</option>
                        </select>
                    </div>
                    
                    <button onclick="login()" style="width: 100%; margin-top: 10px;">ãƒ­ã‚°ã‚¤ãƒ³</button>
                    
                    <div style="margin-top: 30px; padding: 15px; background: #e8f4f8; border-radius: 5px; font-size: 12px;">
                        <strong>ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</strong><br>
                        ğŸ‘¤ customer01 / pass123 (ä¸€èˆ¬é¡§å®¢)<br>
                        ğŸ‘¤ admin01 / admin123 (ç®¡ç†è€…)<br>
                        ğŸ‘¤ auditor01 / audit123 (ç›£æŸ»è€…)
                    </div>
                </div>
            </div>

            <!-- MFAç”»é¢ -->
            <div id="mfaScreen" class="hidden">
                <div class="login-form">
                    <h2 style="text-align: center; margin-bottom: 20px;">å¤šè¦ç´ èªè¨¼</h2>
                    <p style="text-align: center; color: #666; margin-bottom: 20px;">
                        èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                    </p>
                    <div id="mfaError" class="error hidden"></div>
                    <div class="form-group">
                        <label for="mfaCode">èªè¨¼ã‚³ãƒ¼ãƒ‰ï¼ˆ6æ¡ï¼‰</label>
                        <input type="text" id="mfaCode" class="mfa-code" maxlength="6" placeholder="000000">
                    </div>
                    <button onclick="verifyMFA()" style="width: 100%;">èªè¨¼</button>
                    <p style="text-align: center; margin-top: 15px; color: #999; font-size: 12px;">
                        ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ¼ãƒ‰: 123456
                    </p>
                </div>
            </div>

            <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
            <div id="dashboard" class="hidden">
                <!-- ã‚¿ãƒ– -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('overview')">æ¦‚è¦</button>
                    <button class="tab" onclick="switchTab('transactions')">å–å¼•å±¥æ­´</button>
                    <button class="tab" onclick="switchTab('transfer')">æŒ¯è¾¼</button>
                    <button class="tab" onclick="switchTab('cards')">ã‚«ãƒ¼ãƒ‰ç®¡ç†</button>
                    <button class="tab" id="auditTab" onclick="switchTab('audit')" style="display: none;">ç›£æŸ»ãƒ­ã‚°</button>
                </div>

                <!-- æ¦‚è¦ã‚¿ãƒ– -->
                <div id="tabOverview" class="tab-content active">
                    <div class="dashboard">
                        <div class="card">
                            <h3>ğŸ’° å£åº§æ®‹é«˜</h3>
                            <div class="balance" id="balance">Â¥0</div>
                            <p style="margin-top: 10px; color: #666;">å£åº§ç•ªå·: <span id="accountNumber"></span></p>
                        </div>
                        
                        <div class="card">
                            <h3>ğŸ“Š ä»Šæœˆã®å–å¼•</h3>
                            <p style="font-size: 18px; margin-top: 10px;">
                                å…¥é‡‘: <span style="color: #27ae60;" id="monthlyDeposit">Â¥0</span><br>
                                å‡ºé‡‘: <span style="color: #e74c3c;" id="monthlyWithdraw">Â¥0</span>
                            </p>
                        </div>
                        
                        <div class="card">
                            <h3>ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</h3>
                            <div class="card-number" id="cardNumber">****-****-****-****</div>
                            <p style="margin-top: 10px; color: #666;">æœ‰åŠ¹æœŸé™: <span id="cardExpiry"></span></p>
                        </div>
                    </div>
                </div>

                <!-- å–å¼•å±¥æ­´ã‚¿ãƒ– -->
                <div id="tabTransactions" class="tab-content">
                    <h3>å–å¼•å±¥æ­´</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>æ—¥æ™‚</th>
                                <th>ç¨®åˆ¥</th>
                                <th>èª¬æ˜</th>
                                <th>é‡‘é¡</th>
                                <th>æ®‹é«˜</th>
                            </tr>
                        </thead>
                        <tbody id="transactionList"></tbody>
                    </table>
                </div>

                <!-- æŒ¯è¾¼ã‚¿ãƒ– -->
                <div id="tabTransfer" class="tab-content">
                    <h3>æŒ¯è¾¼</h3>
                    <div id="transferMessage"></div>
                    <div class="transaction-form">
                        <div class="form-group">
                            <label for="transferTo">æŒ¯è¾¼å…ˆå£åº§ç•ªå·</label>
                            <input type="text" id="transferTo" placeholder="1234567890" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label for="transferAmount">æŒ¯è¾¼é‡‘é¡ï¼ˆå††ï¼‰</label>
                            <input type="number" id="transferAmount" class="amount-input" placeholder="10000" min="1">
                        </div>
                        <div class="form-group">
                            <label for="transferMemo">ãƒ¡ãƒ¢</label>
                            <textarea id="transferMemo" rows="3" placeholder="æŒ¯è¾¼å†…å®¹"></textarea>
                        </div>
                        <p style="color: #666; font-size: 12px; margin-bottom: 10px;">
                            âš ï¸ 1å›ã®æŒ¯è¾¼ä¸Šé™: Â¥1,000,000<br>
                            âš ï¸ ç®¡ç†è€…æ‰¿èªãŒå¿…è¦ãªé‡‘é¡: Â¥100,000ä»¥ä¸Š
                        </p>
                        <button onclick="transfer()">æŒ¯è¾¼å®Ÿè¡Œ</button>
                    </div>
                </div>

                <!-- ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚¿ãƒ– -->
                <div id="tabCards" class="tab-content">
                    <h3>ã‚«ãƒ¼ãƒ‰æƒ…å ±</h3>
                    <div class="card">
                        <h4>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰è©³ç´°</h4>
                        <p><strong>ã‚«ãƒ¼ãƒ‰ç•ªå·:</strong> <span id="fullCardNumber"></span></p>
                        <p><strong>åç¾©:</strong> <span id="cardHolder"></span></p>
                        <p><strong>æœ‰åŠ¹æœŸé™:</strong> <span id="fullCardExpiry"></span></p>
                        <p><strong>CVV:</strong> <span id="cvv">***</span> <button onclick="toggleCVV()">è¡¨ç¤º</button></p>
                        <p><strong>åˆ©ç”¨é™åº¦é¡:</strong> <span id="cardLimit"></span></p>
                    </div>
                </div>

                <!-- ç›£æŸ»ãƒ­ã‚°ã‚¿ãƒ–ï¼ˆç®¡ç†è€…ãƒ»ç›£æŸ»è€…ã®ã¿ï¼‰ -->
                <div id="tabAudit" class="tab-content">
                    <h3>ç›£æŸ»ãƒ­ã‚°</h3>
                    <div class="audit-log" id="auditLog"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ç®¡ç†
        const appState = {
            currentUser: null,
            sessionTimer: null,
            sessionDuration: 900, // 15åˆ†ï¼ˆç§’ï¼‰
            accounts: {
                'customer01': {
                    password: 'pass123',
                    role: 'customer',
                    name: 'å±±ç”°å¤ªéƒ',
                    accountNumber: '1234567890',
                    balance: 1500000,
                    cardNumber: '4532-1234-5678-9012',
                    cardExpiry: '12/25',
                    cvv: '123',
                    cardLimit: 500000,
                    transactions: [
                        { date: '2024-01-15 14:30', type: 'å…¥é‡‘', desc: 'çµ¦ä¸', amount: 350000, balance: 1500000 },
                        { date: '2024-01-14 09:15', type: 'å‡ºé‡‘', desc: 'ã‚³ãƒ³ãƒ“ãƒ‹ATM', amount: -20000, balance: 1150000 },
                        { date: '2024-01-12 18:45', type: 'æŒ¯è¾¼', desc: 'å®¶è³ƒæ”¯æ‰•ã„', amount: -80000, balance: 1170000 }
                    ]
                },
                'admin01': {
                    password: 'admin123',
                    role: 'admin',
                    name: 'ç®¡ç†è€… èŠ±å­',
                    accountNumber: '9876543210',
                    balance: 5000000,
                    cardNumber: '5412-7534-8642-9753',
                    cardExpiry: '08/26',
                    cvv: '456',
                    cardLimit: 2000000,
                    transactions: [
                        { date: '2024-01-15 10:00', type: 'å…¥é‡‘', desc: 'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è²»', amount: 500000, balance: 5000000 }
                    ]
                },
                'auditor01': {
                    password: 'audit123',
                    role: 'auditor',
                    name: 'ç›£æŸ»äºº æ¬¡éƒ',
                    accountNumber: '5555555555',
                    balance: 2000000,
                    cardNumber: '3782-822463-10005',
                    cardExpiry: '03/27',
                    cvv: '789',
                    cardLimit: 1000000,
                    transactions: []
                }
            },
            auditLogs: [],
            loginAttempts: {}
        };

        // ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            const errorDiv = document.getElementById('loginError');

            // å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!username || !password) {
                showError(errorDiv, 'âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°ãƒã‚§ãƒƒã‚¯ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼‰
            if (!appState.loginAttempts[username]) {
                appState.loginAttempts[username] = { count: 0, lockUntil: null };
            }

            const attempts = appState.loginAttempts[username];
            if (attempts.lockUntil && new Date() < attempts.lockUntil) {
                const remainingTime = Math.ceil((attempts.lockUntil - new Date()) / 1000);
                showError(errorDiv, `ğŸ”’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚æ®‹ã‚Š${remainingTime}ç§’`);
                addAuditLog('error', `ãƒ­ãƒƒã‚¯ä¸­ã®ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ: ${username}`);
                return;
            }

            // èªè¨¼ãƒã‚§ãƒƒã‚¯
            const account = appState.accounts[username];
            if (!account || account.password !== password || account.role !== role) {
                attempts.count++;
                if (attempts.count >= 3) {
                    attempts.lockUntil = new Date(Date.now() + 30000); // 30ç§’ãƒ­ãƒƒã‚¯
                    showError(errorDiv, 'ğŸ”’ ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°è¶…éã€‚30ç§’é–“ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã™');
                    addAuditLog('error', `ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°è¶…é: ${username}`);
                } else {
                    showError(errorDiv, `âŒ èªè¨¼å¤±æ•—ï¼ˆæ®‹ã‚Š${3 - attempts.count}å›ï¼‰`);
                    addAuditLog('warning', `ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ${username}`);
                }
                return;
            }

            // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ â†’ MFAç”»é¢ã¸
            appState.tempUser = account;
            appState.tempUsername = username;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mfaScreen').classList.remove('hidden');
            addAuditLog('info', `ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ˆMFAå¾…ã¡ï¼‰: ${username}`);
        }

        // MFAèªè¨¼
        function verifyMFA() {
            const code = document.getElementById('mfaCode').value;
            const errorDiv = document.getElementById('mfaError');

            if (code !== '123456') {
                showError(errorDiv, 'âŒ èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                addAuditLog('warning', `MFAå¤±æ•—: ${appState.tempUsername}`);
                return;
            }

            // MFAæˆåŠŸ
            appState.currentUser = appState.tempUser;
            appState.currentUsername = appState.tempUsername;
            appState.loginAttempts[appState.tempUsername] = { count: 0, lockUntil: null };

            document.getElementById('mfaScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('userInfo').style.display = 'flex';

            loadDashboard();
            startSessionTimer();
            addAuditLog('info', `MFAèªè¨¼æˆåŠŸ: ${appState.currentUsername}`);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿
        function loadDashboard() {
            const user = appState.currentUser;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
            document.getElementById('userName').textContent = user.name;
            const roleBadge = document.getElementById('roleBadge');
            roleBadge.textContent = getRoleName(user.role);
            roleBadge.className = `role-badge ${user.role}`;

            // ç›£æŸ»ã‚¿ãƒ–ã®è¡¨ç¤ºåˆ¶å¾¡
            if (user.role === 'admin' || user.role === 'auditor') {
                document.getElementById('auditTab').style.display = 'block';
            }

            // å£åº§æƒ…å ±
            document.getElementById('balance').textContent = formatCurrency(user.balance);
            document.getElementById('accountNumber').textContent = user.accountNumber;

            // ä»Šæœˆã®å–å¼•é›†è¨ˆ
            const monthlyStats = calculateMonthlyStats(user.transactions);
            document.getElementById('monthlyDeposit').textContent = formatCurrency(monthlyStats.deposit);
            document.getElementById('monthlyWithdraw').textContent = formatCurrency(Math.abs(monthlyStats.withdraw));

            // ã‚«ãƒ¼ãƒ‰æƒ…å ±
            document.getElementById('cardNumber').textContent = maskCardNumber(user.cardNumber);
            document.getElementById('cardExpiry').textContent = user.cardExpiry;
            document.getElementById('fullCardNumber').textContent = user.cardNumber;
            document.getElementById('cardHolder').textContent = user.name;
            document.getElementById('fullCardExpiry').textContent = user.cardExpiry;
            document.getElementById('cardLimit').textContent = formatCurrency(user.cardLimit);

            // å–å¼•å±¥æ­´
            loadTransactions();
            
            // ç›£æŸ»ãƒ­ã‚°
            if (user.role === 'admin' || user.role === 'auditor') {
                loadAuditLogs();
            }
        }

        // å–å¼•å±¥æ­´èª­ã¿è¾¼ã¿
        function loadTransactions() {
            const tbody = document.getElementById('transactionList');
            tbody.innerHTML = '';
            
            appState.currentUser.transactions.forEach(tx => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${tx.date}</td>
                    <td>${tx.type}</td>
                    <td>${tx.desc}</td>
                    <td style="color: ${tx.amount >= 0 ? '#27ae60' : '#e74c3c'}; font-weight: bold;">
                        ${formatCurrency(tx.amount)}
                    </td>
                    <td>${formatCurrency(tx.balance)}</td>
                `;
            });
        }

        // æŒ¯è¾¼å‡¦ç†
        function transfer() {
            const to = document.getElementById('transferTo').value.trim();
            const amount = parseInt(document.getElementById('transferAmount').value);
            const memo = document.getElementById('transferMemo').value.trim();
            const msgDiv = document.getElementById('transferMessage');

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!to || !/^\d{10}$/.test(to)) {
                showError(msgDiv, 'âŒ æŒ¯è¾¼å…ˆå£åº§ç•ªå·ã¯10æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (!amount || amount <= 0) {
                showError(msgDiv, 'âŒ æŒ¯è¾¼é‡‘é¡ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (amount > 1000000) {
                showError(msgDiv, 'âŒ 1å›ã®æŒ¯è¾¼ä¸Šé™ï¼ˆÂ¥1,000,000ï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™');
                addAuditLog('warning', `æŒ¯è¾¼ä¸Šé™è¶…é: ${appState.currentUsername}, é‡‘é¡: ${amount}`);
                return;
            }

            if (amount > appState.currentUser.balance) {
                showError(msgDiv, 'âŒ æ®‹é«˜ä¸è¶³ã§ã™');
                return;
            }

            if (to === appState.currentUser.accountNumber) {
                showError(msgDiv, 'âŒ è‡ªåˆ†ã®å£åº§ã«ã¯æŒ¯è¾¼ã§ãã¾ã›ã‚“');
                return;
            }

            // é«˜é¡æŒ¯è¾¼ã®æ‰¿èªãƒã‚§ãƒƒã‚¯
            if (amount >= 100000 && appState.currentUser.role === 'customer') {
                showError(msgDiv, 'âš ï¸ Â¥100,000ä»¥ä¸Šã®æŒ¯è¾¼ã¯ç®¡ç†è€…æ‰¿èªãŒå¿…è¦ã§ã™ã€‚æ‰¿èªå¾…ã¡ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚');
                addAuditLog('warning', `æ‰¿èªå¾…ã¡æŒ¯è¾¼: ${appState.currentUsername} â†’ ${to}, é‡‘é¡: ${amount}`);
                return;
            }

            // æŒ¯è¾¼å®Ÿè¡Œ
            appState.currentUser.balance -= amount;
            appState.currentUser.transactions.unshift({
                date: new Date().toLocaleString('ja-JP'),
                type: 'æŒ¯è¾¼',
                desc: `${to} ${memo}`,
                amount: -amount,
                balance: appState.currentUser.balance
            });

            document.getElementById('balance').textContent = formatCurrency(appState.currentUser.balance);
            loadTransactions();
            
            msgDiv.className = 'success';
            msgDiv.textContent = 'âœ… æŒ¯è¾¼ãŒå®Œäº†ã—ã¾ã—ãŸ';
            msgDiv.style.display = 'block';

            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('transferTo').value = '';
            document.getElementById('transferAmount').value = '';
            document.getElementById('transferMemo').value = '';

            addAuditLog('info', `æŒ¯è¾¼å®Ÿè¡Œ: ${appState.currentUsername} â†’ ${to}, é‡‘é¡: ${amount}`);

            setTimeout(() => { msgDiv.style.display = 'none'; }, 3000);
        }

        // CVVè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleCVV() {
            const cvvSpan = document.getElementById('cvv');
            if (cvvSpan.textContent === '***') {
                cvvSpan.textContent = appState.currentUser.cvv;
                addAuditLog('warning', `CVVè¡¨ç¤º: ${appState.currentUsername}`);
            } else {
                cvvSpan.textContent = '***';
            }
        }

        // ç›£æŸ»ãƒ­ã‚°è¿½åŠ 
        function addAuditLog(level, message) {
            appState.auditLogs.push({
                timestamp: new Date().toLocaleString('ja-JP'),
                level: level,
                message: message
            });
        }

        // ç›£æŸ»ãƒ­ã‚°èª­ã¿è¾¼ã¿
        function loadAuditLogs() {
            const logDiv = document.getElementById('auditLog');
            logDiv.innerHTML = '';
            
            appState.auditLogs.slice().reverse().forEach(log => {
                const entry = document.createElement('div');
                entry.className = `log-entry ${log.level}`;
                entry.innerHTML = `
                    <strong>[${log.timestamp}]</strong> ${log.message}
                `;
                logDiv.appendChild(entry);
            });
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼
        function startSessionTimer() {
            let remaining = appState.sessionDuration;
            const timerDiv = document.getElementById('sessionTimer');

            appState.sessionTimer = setInterval(() => {
                remaining--;
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                timerDiv.textContent = `ã‚»ãƒƒã‚·ãƒ§ãƒ³: ${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (remaining <= 60) {
                    timerDiv.style.background = '#e74c3c';
                }

                if (remaining <= 0) {
                    clearInterval(appState.sessionTimer);
                    alert('â±ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
                    logout();
                }
            }, 1000);
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            if (appState.sessionTimer) {
                clearInterval(appState.sessionTimer);
            }
            addAuditLog('info', `ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ: ${appState.currentUsername}`);
            
            appState.currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');

            if (tabName === 'audit') {
                loadAuditLogs();
            }
        }

        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function formatCurrency(amount) {
            return 'Â¥' + amount.toLocaleString('ja-JP');
        }

        function maskCardNumber(cardNumber) {
            const parts = cardNumber.split('-');
            return parts.map((p, i) => i < 3 ? '****' : p).join('-');
        }

        function getRoleName(role) {
            const names = { customer: 'ä¸€èˆ¬é¡§å®¢', admin: 'ç®¡ç†è€…', auditor: 'ç›£æŸ»è€…' };
            return names[role] || role;
        }

        function calculateMonthlyStats(transactions) {
            const now = new Date();
            const thisMonth = transactions.filter(tx => {
                const txDate = new Date(tx.date);
                return txDate.getMonth() === now.getMonth();
            });

            return {
                deposit: thisMonth.filter(tx => tx.amount > 0).reduce((sum, tx) => sum + tx.amount, 0),
                withdraw: thisMonth.filter(tx => tx.amount < 0).reduce((sum, tx) => sum + tx.amount, 0)
            };
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 5000);
        }

        // åˆæœŸåŒ–
        addAuditLog('info', 'ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•');
    </script>
</body>
</html>
